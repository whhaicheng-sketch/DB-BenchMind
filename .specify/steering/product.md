# DB-BenchMind 产品定义文档 (product.md)

**版本**: 1.0.0
**日期**: 2026-01-27
**状态**: Active

---

## 1. 问题定义

### 1.1 核心问题

数据库性能测试工程师和 DBA 在日常工作中面临以下痛点：

1. **工具分散，学习成本高**
   - 不同数据库需要不同的压测工具（Sysbench、Swingbench、HammerDB）
   - 每个工具都有独立的命令行接口和参数体系
   - 新工程师需要学习多个工具的使用方法

2. **结果难以管理和复现**
   - 压测结果散落在各个目录，难以归档
   - 缺乏配置快照机制，无法精确复现测试场景
   - 历史数据难以查询和对比分析

3. **报告生成繁琐**
   - 需要手动整理日志、截图、数据
   - 缺乏统一的报告格式和模板
   - 多格式导出（Markdown、HTML、PDF）需要额外工具

4. **缺乏实时监控能力**
   - 命令行工具只能看到最终结果
   - 无法实时查看 TPS、延迟、错误率等关键指标
   - 异常情况无法及时发现和干预

### 1.2 解决方案

**DB-BenchMind** 是一款桌面压测工作台，通过统一的 GUI 界面解决上述问题：

- **统一入口**：一个应用管理所有数据库和压测工具
- **可复现性**：每次压测保存完整配置快照
- **可对比性**：多次运行结果可对比分析，支持基线管理
- **可交付性**：多格式报告一键导出
- **实时监控**：压测过程中实时显示关键指标和日志

---

## 2. 用户与范围边界

### 2.1 目标用户

| 用户角色 | 典型职责 | 核心需求 |
|---------|---------|---------|
| **数据库性能测试工程师** | 对数据库进行性能压测、性能分析 | 快速配置压测任务、实时监控、结果对比 |
| **DBA（数据库管理员）** | 维护数据库性能、排查性能问题 | 复用历史压测场景、对比不同版本的数据库性能 |
| **数据库研发工程师** | 优化数据库内核、测试新特性 | 对比优化前后的性能差异、生成性能报告 |

### 2.2 使用场景

#### 场景 1：MySQL 性能基准测试

**背景**：新部署的 MySQL 8.0 数据库，需要测试其在 OLTP 场景下的性能表现。

**操作流程**：
1. 启动 DB-BenchMind
2. 在"连接管理"页面添加 MySQL 连接配置
3. 在"场景模板"页面选择 "Sysbench OLTP Read-Write" 模板
4. 在"任务配置"页面配置参数（线程数：16、时长：300秒）
5. 点击"启动"，在"运行监控"页面实时查看 TPS 和延迟
6. 测试完成后，在"报告导出"页面导出 PDF 报告

**预期结果**：
- 无需记忆 Sysbench 命令行参数
- 实时看到性能指标，无需等待测试结束
- 获得格式规范的 PDF 报告，可直接交付

#### 场景 2：Oracle 数据库升级前后性能对比

**背景**：计划将 Oracle 从 19c 升级到 21c，需要对比升级前后的性能差异。

**操作流程**：
1. 在 Oracle 19c 环境运行压测任务，记录为 "Baseline-v19c"
2. 升级数据库到 21c
3. 使用相同的配置重新运行压测任务，记录为 "Test-v21c"
4. 在"结果对比"页面选择两次运行记录进行对比
5. 查看核心指标差异（TPS 变化、延迟变化、错误率变化）
6. 导出对比报告（包含趋势图和差异数据）

**预期结果**：
- 精确量化升级前后的性能差异
- 趋势图直观展示性能变化
- 为升级决策提供数据支持

#### 场景 3：SQL Server 参数调优验证

**背景**：调整了 SQL Server 的某个配置参数，需要验证其对性能的影响。

**操作流程**：
1. 调整参数前运行压测，记录为 "Before-Tuning"
2. 修改 SQL Server 配置参数
3. 使用相同配置重新运行压测，记录为 "After-Tuning"
4. 在对比页面查看差异
5. 如果性能提升，保存配置为新的最佳实践

**预期结果**：
- 快速验证调优效果
- 建立性能调优的最佳实践库

### 2.3 范围边界（In Scope vs Out of Scope）

#### In Scope（范围内）

| 功能模块 | 说明 |
|---------|------|
| **数据库连接管理** | 支持 MySQL、Oracle、SQL Server、PostgreSQL 的连接配置与测试 |
| **内置场景模板** | 提供 7 个内置压测模板（Sysbench 3个、Swingbench 2个、HammerDB 2个） |
| **自定义模板** | 支持导入/导出自定义模板（JSON 格式） |
| **任务编排执行** | 支持完整的压测流程（prepare → warmup → run → cleanup） |
| **实时监控** | 实时显示 TPS、延迟、错误率、日志 |
| **结果归档** | 保存所有运行记录到 SQLite，支持历史查询 |
| **结果对比** | A/B 对比、基线对比、趋势分析 |
| **报告导出** | Markdown、HTML、JSON、PDF 四种格式 |
| **工具适配** | 适配 Sysbench、Swingbench、HammerDB 三个工具 |

#### Out of Scope（范围外）

| 功能 | 原因 | 替代方案 |
|------|------|---------|
| **分布式压测** | MVP 范围，单机压测已满足需求 | 使用工具的原生分布式功能 |
| **自定义图表编辑器** | 工作量大，内置图表已足够 | 导出数据后用 Excel/Python 分析 |
| **Web 界面** | MVP 范围，桌面应用更适合工程师 | 无替代方案 |
| **压测工具内置** | 依赖外部工具，增加维护成本 | 用户自行安装压测工具 |
| **自动参数调优** | 属于高级功能，算法复杂 | 提供对比功能，人工调优 |
| **多语言支持** | MVP 范围，中文优先 | 无替代方案 |

---

## 3. 核心概念

| 概念 | 定义 | 示例 |
|------|------|------|
| **Connection（连接）** | 数据库连接配置，包含连接参数与认证信息 | MySQL-生产库（192.168.1.100:3306） |
| **Template（模板）** | 工具与 workload 的预定义配置 | Sysbench OLTP Read-Write |
| **Scenario（场景）** | 具体的压测场景，由模板 + 参数组成 | 100 线程、300 秒 OLTP 读写 |
| **Task（任务）** | 一次压测的完整配置，包含连接、模板、参数快照 | Task-20260127-001 |
| **Run（运行）** | 任务的一次执行记录，包含状态、日志、结果 | Run-abc123-def456 |
| **Result（结果）** | 解析后的指标数据与摘要 | TPS: 1250.67, P95: 3.45ms |
| **Report（报告）** | 导出的测试报告文件 | report.md, report.html, report.pdf |
| **Baseline（基线）** | 作为对比基准的运行记录 | Run-previous-v1.0 |

---

## 4. 成功标准

### 4.1 功能验收标准

1. **连接管理**
   - [ ] 能成功添加/编辑/删除 4 种数据库的连接配置
   - [ ] 能测试连接并显示连接状态（成功/失败及原因）
   - [ ] 密码安全存储到 keyring

2. **模板管理**
   - [ ] 能查看 7 个内置模板
   - [ ] 能导入自定义模板并校验 JSON Schema
   - [ ] 能导出模板到文件

3. **任务执行**
   - [ ] 能成功运行 Sysbench 对 MySQL 进行压测
   - [ ] 能成功运行 Swingbench 对 Oracle 进行压测
   - [ ] 能成功运行 HammerDB 对 SQL Server 进行压测
   - [ ] 能实时查看 TPS、延迟、错误率
   - [ ] 能启动/停止/取消任务

4. **结果管理**
   - [ ] 能查看历史运行记录
   - [ ] 能查看某次运行的详情（指标、日志、配置）
   - [ ] 能对比两次运行的差异

5. **报告导出**
   - [ ] 能导出 Markdown 格式报告
   - [ ] 能导出 HTML 格式报告
   - [ ] 能导出 JSON 格式报告
   - [ ] 能导出 PDF 格式报告

### 4.2 非功能验收标准

| 指标 | 目标 | 验证方法 |
|------|------|---------|
| GUI 响应时间 | < 100ms | 手动测试所有页面切换 |
| 任务执行可靠性 | 99%+ | 运行 100 次任务，成功率 ≥ 99 |
| 长时间运行稳定性 | 24h 无崩溃 | 长时间运行测试 |
| 内存占用 | < 500MB（运行中） | 性能测试 |
| 数据完整性 | 100% | 所有运行记录和日志完整保存 |

---

## 5. 约束与假设

### 5.1 技术约束

- **操作系统**: Ubuntu 24（带桌面 GUI）
- **Go 版本**: 1.22.2
- **GUI 框架**: Fyne v2.x（跨平台）
- **数据库**: SQLite（modernc.org/sqlite，无 CGO）
- **密钥管理**: gnome-keyring

### 5.2 业务约束

- 压测工具必须由用户自行安装（Sysbench/Swingbench/HammerDB）
- 不会内置任何压测工具的二进制文件
- 报告导出依赖外部工具（pandoc/wkhtmltopdf），未安装时提供降级方案

### 5.3 假设

- 用户具备基本的数据库知识和操作能力
- 用户能正确安装和配置压测工具
- 用户的测试环境网络稳定，工具能连接到目标数据库
- Ubuntu 24 默认已安装 gnome-keyring

---

## 6. 依赖与风险

### 6.1 外部依赖

| 依赖 | 版本 | 风险等级 | 缓解措施 |
|------|------|---------|---------|
| **Fyne** | v2.x | 中 | 定期更新，关注社区动态 |
| **Sysbench** | >= 1.0 | 低 | 提供安装文档，版本检测 |
| **Swingbench** | 最新 | 高 | 提供 JAR 路径配置，清晰的安装指南 |
| **HammerDB** | 最新 | 高 | 提供路径配置，清晰的安装指南 |
| **pandoc**（可选） | 任意 | 中 | 未安装时仅禁用 PDF 导出 |
| **gnome-keyring** | 系统自带 | 低 | 未安装时降级为加密文件 |

### 6.2 技术风险

| 风险 | 影响 | 概率 | 缓解措施 |
|------|------|------|---------|
| Fyne GUI 性能问题 | 高 | 中 | 早期原型验证；goroutine 异步加载 |
| 工具输出格式变化 | 高 | 中 | 灵活解析器；失败时保留原始输出 |
| SQLite 并发限制 | 中 | 低 | 写入队列；WAL 模式 |
| Swingbench/HammerDB 路径依赖 | 高 | 高 | 提供清晰的安装文档；自动检测提示 |

---

## 7. 版本规划

### MVP（v1.0） - 12 周

- [x] Phase 1: 项目初始化与基础设施
- [ ] Phase 2: 连接管理
- [ ] Phase 3: 模板系统与任务配置
- [ ] Phase 4: 工具适配器与执行编排
- [ ] Phase 5: 结果存储与历史记录
- [ ] Phase 6: 报告生成与导出
- [ ] Phase 7: 结果对比功能
- [ ] Phase 8: 设置页面与文档

### 未来版本（v2.0+）

- 分布式压测支持
- 自定义图表编辑器
- Web 界面
- 多语言支持
- 自动参数调优
- 压测工具内置

---

## 8. 变更记录

| 版本 | 日期 | 变更内容 | 作者 |
|------|------|---------|------|
| 1.0.0 | 2026-01-27 | 初始版本 | Claude |

---

**文档结束**
